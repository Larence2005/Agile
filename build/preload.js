/*! For license information please see preload.js.LICENSE.txt */
"use strict";var electron=require("electron"),adblocker={};Object.defineProperty(adblocker,"__esModule",{value:!0}),adblocker.injectScript=adblocker.autoRemoveScript=DOMMonitor_1=adblocker.DOMMonitor=adblocker.extractFeaturesFromDOM=void 0;const SCRIPT_ID="cliqz-adblocker-script",IGNORED_TAGS=new Set(["br","head","link","meta","script","style","s"]);function isElement(e){return 1===e.nodeType}function getElementsFromMutations(e){const t=[];for(const s of e)if("attributes"===s.type)isElement(s.target)&&t.push(s.target);else if("childList"===s.type)for(const e of s.addedNodes)isElement(e)&&e.id!==SCRIPT_ID&&t.push(e);return t}function extractFeaturesFromDOM(e){const t=new Set(["br","head","link","meta","script","style","s"]),s=new Set,o=new Set,r=new Set;for(const n of e)for(const e of[n,...n.querySelectorAll("[id],[class],[href]")]){if(t.has(e.nodeName.toLowerCase()))continue;const n=e.id;n&&r.add(n);const i=e.classList;if(i)for(const e of i)s.add(e);const c=e.getAttribute("href");"string"==typeof c&&o.add(c)}return{classes:Array.from(s),hrefs:Array.from(o),ids:Array.from(r)}}adblocker.extractFeaturesFromDOM=extractFeaturesFromDOM;class DOMMonitor{constructor(e){this.cb=e,this.knownIds=new Set,this.knownHrefs=new Set,this.knownClasses=new Set,this.observer=null}queryAll(e){this.cb({type:"elements",elements:[e.document.documentElement]}),this.handleUpdatedNodes([e.document.documentElement])}start(e){null===this.observer&&void 0!==e.MutationObserver&&(this.observer=new e.MutationObserver((e=>{this.handleUpdatedNodes(getElementsFromMutations(e))})),this.observer.observe(e.document.documentElement,{attributes:!0,attributeFilter:["class","id","href"],childList:!0,subtree:!0}))}stop(){null!==this.observer&&(this.observer.disconnect(),this.observer=null)}handleNewFeatures({hrefs:e,ids:t,classes:s}){const o=[],r=[],n=[];for(const e of t)!1===this.knownIds.has(e)&&(o.push(e),this.knownIds.add(e));for(const e of s)!1===this.knownClasses.has(e)&&(r.push(e),this.knownClasses.add(e));for(const t of e)!1===this.knownHrefs.has(t)&&(n.push(t),this.knownHrefs.add(t));return(0!==o.length||0!==r.length||0!==n.length)&&(this.cb({type:"features",classes:r,hrefs:n,ids:o}),!0)}handleUpdatedNodes(e){return 0!==e.length&&(this.cb({type:"elements",elements:e.filter((e=>!1===IGNORED_TAGS.has(e.nodeName.toLowerCase())))}),this.handleNewFeatures(extractFeaturesFromDOM(e)))}}var DOMMonitor_1=adblocker.DOMMonitor=DOMMonitor;function autoRemoveScript(e){return`try{${e}}catch(c){}!function(){var c=document.currentScript,e=c&&c.parentNode;e&&e.removeChild(c)}();`}function injectScript(e,t){const s=t.createElement("script");s.type="text/javascript",s.id=SCRIPT_ID,s.async=!1,s.appendChild(t.createTextNode(autoRemoveScript(e)));const o=t.head||t.documentElement;null!==o&&o.appendChild(s)}function getCosmeticsFilters(e){setTimeout((()=>{electron.ipcRenderer.send("get-cosmetic-filters",window.location.href,e)}),1)}adblocker.autoRemoveScript=autoRemoveScript,adblocker.injectScript=injectScript,window===window.top&&!1===window.location.href.startsWith("devtools://")&&(()=>{const e=electron.ipcRenderer.sendSync("is-mutation-observer-enabled");let t=!0,s=null;const o=()=>{null!==s&&(s.stop(),s=null)};electron.ipcRenderer.on("get-cosmetic-filters-response",((e,{active:s})=>{if(!1===s)return t=!1,void o();t=!0})),getCosmeticsFilters({lifecycle:"start",ids:[],classes:[],hrefs:[]}),window.addEventListener("DOMContentLoaded",(()=>{s=new DOMMonitor_1((e=>{"features"===e.type&&getCosmeticsFilters(Object.assign(Object.assign({},e),{lifecycle:"dom-update"}))})),s.queryAll(window),t&&e&&s.start(window)}),{once:!0,passive:!0}),window.addEventListener("unload",o,{once:!0,passive:!0})})();